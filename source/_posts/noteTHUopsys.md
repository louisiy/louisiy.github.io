---
title: 操作系统笔记
date: 2024-03-04 19:18:00
tags: Operation System
---

## 概述

### 指令

指令是计算机运行的最小的功能单元，是指挥计算机硬件运行的命令

- 算术运算指令
- 逻辑运算指令
- 移位操作指令
- 数据传送指令
- 输入输出指令
- 转移指令等

操作码 + 操作数

在硬件和应用软件之间引入操作系统

- 管理系统的各个部件，使之能正常运转；
- 给上层的应用软件提供一个易于理解和编程的接口

### 操作系统发展历史

- 1946-1950
  - 机器语言，纸带或卡片
- 50年代末-60年代中
  - 批处理管理程序
  - 串行执行，单道批处理
  - 60年代初发展了通道与中断技术
- 60年代中-70年代中
  - 现代意义上的操作系统的出现
  - 多道批处理系统
- 70年代中-至今
  - 分时系统
    - CTSS
    - MULTICS
    - UNIX
- 个人计算机操作系统

### 操作系统类型

- 批处理操作系统（多道批处理）
- 分时操作系统
- 实时操作系统
- 嵌入式系统
- 个人计算机操作系统
- 分布式操作系统

### 操作系统需要的硬件特性

#### 受保护的指令

- 对某些硬件资源直接访问的指令
- 对内存管理状态进行操作的指令
- 某些特殊的状态位的设置指令

- 停机指令

根据运行程序对资源和机器指令的使用权限，把处理器设置为不同状态

- 管态：操作系统的管理程序运行时的状态，较高的特权级别，又称为特权态、系统态、内核态，处于该状态时可以执行所有的指令（包括特权指令）、使用所有的资源，并具有改变处理器状态的能力
- 目态：用户程序运行时的状态，较低的特权级别，又称为普通态（普态）、用户态。在此状态下禁止使用特权指令，不能直接使用系统资源与改变CPU状态，并且只能访问用户程序所在的存储空间

有的系统分为核心状态，管理状态和用户程序状态（目标状态）三种

程序状态字PSW (Program Status Word )一个专门的寄存器，用来指示处理器的状态，包括

- CPU的工作状态码
- 条件码
- 中断屏蔽码

![image-20240311204447522](https://cdn.jsdelivr.net/gh/louisiy/ImageStorage/img/image-20240311204447522.png)

#### 系统调用

用户程序通过特殊的访管指令，来请求操作系统为其提供某种功能的服务

- 当CPU执行访管指令时，即引起访管中断；
- 处理器保存中断点的程序执行上下文环境（PSW,    PC和其他的一些寄存器），CPU切换到内核态。
- 中断处理程序开始工作，调用相应的系统服务；
- 中断处理结束后，恢复被中断程序的上下文环境，CPU恢复为用户态，回到中断点继续执行。

#### 内存保护

- 防止一个用户程序去访问其他用户 程序的数据；
- 保护操作系统免受用户程序的破坏。

最简单的做法：基址寄存器和边界寄存器。在开始运行一个程序时，由操作系统负责给基址寄存器和边界寄存器设置相应的值

虚拟存储技术：把内存和外存结合起来使用，硬件提供虚、实地址映射的机制。

#### 中断机制

- 同步中断：指当CPU正在执行指令的时候，由CPU的控制单元所发出的中断，也称为“异常”
  - CPU检测到的异常，包括：错误Fault、陷阱Trap和中止Abort，例如：算术溢出、被零除、用户态下使用了特权指令等；
  - 程序设定的异常，即程序员通过int、int3等指令来发出的中断请求，也称为软中断，主要用来实现系统调用服务。
- 异步中断：指由其他的硬件设备在任意的时刻所发出的中断，简称为“中断” ；
  - 可屏蔽中断，即I/O中断，它是当外部设备或通道操作正常结束或发生错误时所发生的中断。例如：打印机打印完成、缺纸，读磁盘时驱动器中没有磁盘等；
  - 不可屏蔽中断，例如：由掉电、存储器校验错等硬件故障引起的硬件中断；

每一个中断或异常都用一个0－255之间的整数来标识，称为中断向量，系统根据中断向量，来为每一个中断或异常指定相应的处理程序

#### I/O系统

完成计算机系统中信息的输入输出功能

#### 时钟操作

时钟是操作系统运行时必不可少的硬件设施，在操作系统中需要时钟支持的工作有：

- 在分时系统中，间隔时钟实现进程间按时间片轮转；
- 在实时系统中，按要求的间隔输出正确的时间信号给实时的控制设备；
- 记录用户和系统所需的绝对时间（年、月、日、时、分、秒）。

## 进程管理

### 进程 process

#### 前置知识

CPU

![image-20240311192818883](https://cdn.jsdelivr.net/gh/louisiy/ImageStorage/img/image-20240311192818883.png)

- 控制单元
  - 能够正确并且自动地连续执行指令
  - 能正确并分步完成每一条指令的功能读取指令、分析指令、控制执行
  - 响应并处理中断
- 执行单元
  - CPU的“计算器”
  - 分为不同的功能部件，包括算术逻辑单元（ALU，+-*/）、移位器、乘法器、除法器、分支单元等
  - 来自控制单元的信号选择不同的功能部件
- 寄存器组
  - General-purpose register
  - Segment register
  - EFLAGS register
  - EIP

虚拟/物理计算机

- 虚拟CPU
- 虚拟内存
  - 栈
  - 堆
  - 静态数据
  - 代码

#### 进程基本

process = program in execution

一个进程应该包括：

- 程序的代码；
- 程序的数据；
- CPU寄存器的值，如PC，用来指示下一条将运行     的指令、通用寄存器等；
- 堆、栈；
- 一组系统资源（如地址空间、打开的文件）

总之，进程包含了正在运行的一个程序的所有状态信息。

栈Stack

- 只允许在一端插入和删除。允许插入和删除的一端称为栈顶 (top)，另一端称为栈底 (bottom)
- 特点：后进先出(LIFO)
- 栈的主要操作
  - 进栈 Push
  - 出栈 Pop
- 栈的用途
  - 用于暂存功能，在程序运行时保存运行上下文信息
  - 在函数调用发生时，保存被调用函数的局部变量和形参

堆Heap

- 内存中的一块空间，用于动态分配；
- 在C语言中，通过malloc来申请动态内存空间，通过free来释放；
- 使用不当可能导致内存泄漏。

#### 进程的特性

- 动态性：程序的运行状态在变，PC、寄存器、堆和栈等；
- 独立性：是一个独立的实体，是计算机系统资源的使用单位。每个进程在一个“虚拟计算机”上运行，每个进程都有“自己”的PC和内部状态，运行时独立于其他的进程（虚拟PC和物理PC）；
- 并发性：从宏观上看各进程是同时独立运行的

#### 进程的创建

引起进程创建的三个主要事件：

- 系统初始化时；
- 在一个正在运行的进程当中，执行了创建进程的系统调用；
- 用户请求创建一个新进程。

从技术上来说，只有一种创建进程的方法，即在一个已经存在的进程（用户进程或系统
进程）当中，通过系统调用来创建一个新的进程。

- Unix：`fork`函数；
- Windows：`CreateProcess`函数;

#### 进程的状态

进程的三种基本状态：

- 运行状态（Running）：进程占有CPU，并在CPU上运行。处于此状态的进程数目小于等于CPU的数目。
- 就绪状态（Ready）：进程已经具备运行条件，但由于CPU忙暂时不能运行，只要分得CPU即可执行；
- 阻塞状态（Blocked）：指进程因等待某种事件的发生而暂时不能运行的状态（如I/O操作或进程同步）,此时，即使CPU空闲，该进程也不能运行。

进程转换

- 运行 --> 阻塞
  - 等待I/O的结果
  - 等待某一进程提供输入
- 运行 --> 就绪
  - 运行进程用完了时间片
  - 运行进程被中断，因为一高优先级进程处于就绪状态
- 就绪 --> 运行
  - 调度程序选择一个新的进程运行
- 阻塞 --> 就绪
  - 当所等待的事件发生时

### 线程 thread

### 进程间通信

### 进程调度

